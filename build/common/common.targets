<Project ToolsVersion="15.0">
  <!-- Symbols -->
  <ItemGroup Condition=" '$(PackProject)' == 'true' AND '$(SkipSourceLink)' != 'true' ">
    <PackageReference Include="SourceLink.Create.GitHub" Version="2.0.2" PrivateAssets="all" />
    <DotNetCliToolReference Include="dotnet-sourcelink-git" Version="2.0.2" />
    <DotNetCliToolReference Include="dotnet-sourcelink" Version="2.0.2" />
  </ItemGroup>

  <!-- Nupkg -->
  <PropertyGroup Condition=" '$(PackProject)' == 'true' AND '$(SkipDocs)' != 'true' ">
    <DocumentationFile>bin\$(Configuration)\$(TargetFramework)\$(AssemblyName).xml</DocumentationFile>
    <NoWarn>1591;1573</NoWarn>
  </PropertyGroup>

  <!-- Create nupkg hook -->
  <PropertyGroup Condition=" '$(PackProject)' == 'true' ">
    <IsPackable>true</IsPackable>
    <IncludeSymbols Condition=" '$(IncludeSymbols)' == '' ">true</IncludeSymbols>
    <PackageOutputPath>$(ArtifactsDirectory)</PackageOutputPath>
    <NoPackageAnalysis>true</NoPackageAnalysis>
  </PropertyGroup>

  <!-- Version -->
  <PropertyGroup>
    <ApplyBuildNumber Condition=" '$(ApplyBuildNumber)' == '' ">true</ApplyBuildNumber>
    <BuildNumber Condition=" '$(BuildNumber)' == '' ">$([System.DateTime]::UtcNow.Year).$([System.DateTime]::UtcNow.Month).$([System.DateTime]::UtcNow.Day).$([System.DateTime]::UtcNow.Hour).$([System.DateTime]::UtcNow.Minute)</BuildNumber>
    <Version>$(StableVersion)</Version>
    <Version Condition=" '$(ReleaseLabel)' != '' ">$(Version)-$(ReleaseLabel)</Version>
    <Version Condition=" '$(ReleaseLabel)' != '' AND '$(ApplyBuildNumber)' == 'true' ">$(Version).$(BuildNumber)</Version>
  </PropertyGroup>

  <!-- Test projects -->
  <PropertyGroup Condition=" '$(TestProject)' == 'true' ">
    <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
    <GenerateBindingRedirectsOutputType>true</GenerateBindingRedirectsOutputType>
    <OutputType>Exe</OutputType>
  </PropertyGroup>

  <ItemGroup Condition=" '$(TestProject)' == 'true' ">
    <None Include="$(BuildCommonDirectory)TestShared\xunit.runner.json">
      <Link>xunit.runner.json</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <ItemGroup Condition=" '$(TestProject)' == 'true' ">
    <PackageReference Include="FluentAssertions" Version="$(FluentAssertionsVersion)" />
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="$(TestSDKVersion)" />
    <PackageReference Include="xunit.runner.visualstudio" Version="$(XunitVersion)" />
    <PackageReference Include="xunit" Version="$(XunitVersion)" />
  </ItemGroup>

  <!--
    ============================================================
    TestProject
    Runs tests on the current project if it is a test project.
    ============================================================
  -->
  <Target Name="TestProject" Condition=" '$(TestProject)' == 'true' " DependsOnTargets="VSTest">
    <Message Text="Tested project $(MSBuildProjectName)" Importance="high"  />
  </Target>

  <!--
    ============================================================
    PackProject
    Packs the current project if it is marked as a pack project.
    ============================================================
  -->
  <Target Name="PackProject" Condition=" '$(PackProject)' == 'true' " DependsOnTargets="Pack">
    <Message Text="Packed project $(MSBuildProjectName)" Importance="high"  />
  </Target>
</Project>